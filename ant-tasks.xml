<?xml version="1.0" encoding="UTF-8"?>
<!-- +=====================================================================+ -->
<!-- |                                                                     | -->
<!-- |                      a n t - t a s k s . x m l                      | -->
<!-- |                                                                     | -->
<!-- +=====================================================================+ -->
<project name="proxymusic">

    <description>
        Collection of Ant tasks meant to be called from Maven.
    </description>
    
    <property name="generated.src.dir" location="${basedir}/target/generated-sources/java" /> 
    
    <!-- retrieve-id -->
    <target name="retrieve-id"
            description="Retrieve Git information">
        <exec executable="git" outputproperty="program.revision">
            <arg line='log -1 --pretty=format:"%h"' />
        </exec>
        <echo level="info" message="-- program.revision=${program.revision}" />
    </target>

    <!-- generate-program-id -->
    <target name="generate-program-id"
            depends="retrieve-id"
            description="Write a Java class to gather program identification">
        <echo level="info" message="-- Writing to file ${generated.src.dir}/com/audiveris/proxymusic/util/ProgramId.java" />
        <mkdir dir="${generated.src.dir}/org/audiveris/proxymusic/util" />
        <echo level="debug" file="${generated.src.dir}/org/audiveris/proxymusic/util/ProgramId.java"><![CDATA[
package org.audiveris.proxymusic.util;

/** 
 * Interface {@code ProgramId} provides full program identification.
 * This code is generated by an Ant target using Git information.
 */
public interface ProgramId 
{
    /** Precise program name: {@value} */
    public static final java.lang.String NAME = "${program.name}";

    /** Precise program version: {@value} */
    public static final java.lang.String VERSION = "${program.version}";

    /** Precise program revision: {@value} */
    public static final java.lang.String REVISION = "${program.revision}";
}]]>
        </echo> 
    </target>
    
    <!-- Fix javadoc tags in generated JAXB sources -->
    <target name="fix-tags"
            description="Fix javadoc tags in generated JAXB sources">
        <echo level="info" message="fix-tags in ${basedir}/target/generated-sources/jaxb" />
        <replace dir="${basedir}/target/generated-sources/jaxb"
                 encoding="UTF-8">
            <include name="**/*.java"/>
            
            <!--                      &lt;      =>         < -->
            <replacefilter token="&amp;lt;"     value="&#60;" />
            
            <!--                      &gt;      =>         > -->
            <replacefilter token="&amp;gt;"     value="&#62;" />
            
            <!--                      &amp;gt;  =>         > -->
            <replacefilter token="&amp;amp;gt;" value="&#62;" />
            
            <!--                      &amp;     =>         & -->
<!--            <replacefilter token="&amp;amp;"    value="&#38;" />-->
        </replace>
    </target>

</project>
