<?xml version="1.0" encoding="UTF-8"?>
<!-- +=====================================================================+ -->
<!-- |                                                                     | -->
<!-- |                      a n t - t a s k s . x m l                      | -->
<!-- |                                                                     | -->
<!-- +=====================================================================+ -->
<project name="proxymusic">
    
    <description>
        Collection of Ant tasks meant to be called from Maven.
    </description>
    
    <property name="generated.src.dir" location="${basedir}/target/generated-sources/java" /> 
    
    <!-- retrieve-id -->
    <target name="retrieve-id"
            description="Retrieve Hg information">
        <exec executable="hg"
              outputproperty="program.revision">
            <arg line='log -r tip --template "{rev}"' />
        </exec>
        <echo message="-- program.revision=${program.revision}" />
        <exec executable="hg"
              outputproperty="program.build">
            <arg line='log -r tip --template "{node|short}"' />
        </exec>
        <echo message="-- program.build=${program.build}" />
    </target>
        
    <!-- generate-program-id -->
    <target name="generate-program-id"
            depends="retrieve-id"
            description="Write a Java class to gather program identification">
        <echo message="-- Writing to file ${generated.src.dir}/com/audiveris/proxymusic/util/ProgramId.java" />
        <mkdir dir="${generated.src.dir}/com/audiveris/proxymusic/util" />
        <echo file="${generated.src.dir}/com/audiveris/proxymusic/util/ProgramId.java"><![CDATA[
package com.audiveris.proxymusic.util;

/** 
 * Class {@code ProgramId} provides full program identification.
 * This code is generated by an Ant target using Hg information.
 */
public class ProgramId 
{
    /** Precise program name: {@value} */
    public static final java.lang.String NAME = "${program.name}";

    /** Precise program version: {@value} */
    public static final java.lang.String VERSION = "${program.version}";

    /** Precise program revision: {@value} */
    public static final java.lang.String REVISION = "${program.revision}";

    /** Precise program build: {@value} */
    public static final java.lang.String BUILD = "${program.build}";
}]]>
        </echo> 
    </target>
    
    <!-- generate-java-classes -->
    <target name="generate-java-classes"
            description="Generate Java classes from MusicXML schema">
        <echo message="-- Generating Java classes from Schema ..." />
        <property name="xsd.dir" location="${basedir}/src/main/schema" /> 

        <!-- Not using ant task (no need for JAXB RI)-->
        <exec executable="${java.home}/../bin/xjc.exe">
            <arg line="-p com.audiveris.proxymusic"/>
            <arg line="-d ${generated.src.dir}"/>
            <arg line="-no-header"/>
            <arg line="-b ${xsd.dir}/custom.xjb"/>
            <arg line="${xsd.dir}/musicxml.fixed.xsd"/>
        </exec>
    </target>

</project>
